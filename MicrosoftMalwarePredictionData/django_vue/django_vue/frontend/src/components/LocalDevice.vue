<template>
    <div>
        <NavBar></NavBar>
        <div>
            <b-nav tabs justified>
                <b-nav-item active>All</b-nav-item>
                <b-nav-item >Vulnerable</b-nav-item>
                <b-nav-item>Not Vulnerable</b-nav-item>
            </b-nav>
        </div>
        <div>
            <b-table sticky-header :items="nist_vulns" :nist_fields="nist_fields" :tbody-tr-class="localIsVulnerable" head-variant="dark"></b-table>
            <b-table sticky-header :items="vulnerabilities" :postgres_fields="postgres_fields" :tbody-tr-class="localIsVulnerable" head-variant="dark"></b-table>
        </div>
        <!-- <div class="table table-hover">
          <thead class="thead-dark">
            <th>ID</th>
            <th>CVE</th>
            <th>Affrected Version</th>
            <th>Fixed Version</th>
            <th>CVSS</th>
            <th>Description</th>
          </thead>
          <tbody class="table-info">
            <tr v-for="vuln in vulnerabilities" :key="vuln.id" class="table-warning">
              <td>{{vuln.id}}</td>
              <td>{{vuln.postgres_cve}}</td>
              <td>{{vuln.postgres_affected_ver}}</td>
              <td>{{vuln.postgres_fixed_ver}}</td>
              <td>{{vuln.postgres_cvss}}</td>
              <td>{{vuln.postgres_descript}}</td>
            </tr>
          </tbody>
        </div> -->
        <!-- {{vulnerabilities}} -->
    </div>
</template>

<script>
import NavBar from '@/components/NavBar'

export default {
    name: 'LocalDevice',
    components: {
        NavBar,
    },
    data() {
        return {
            postgres_vuln_api_url: 'http://127.0.0.1:8000/networks/postgresvuln/',
            postgres_fields: ['postgres_cve','postgres_affected_ver','postgres_fixed_ver','postgres_cvss','postgres_descript'],
            nist_vuln_api_url: 'http://127.0.0.1:8000/networks/nistvuln/',
            nist_fields:['nist_cve','nist_cvss','nist_affect_ver','nist_keyword_warning','nist_descript'],
            nist_vulns: [],
            vulnerabilities: [],
            // items:[]
        }
    },
    mounted() {
        const axios = require('axios')
        this.interval = setInterval(() =>{
            axios.get(this.postgres_vuln_api_url).then((response) => {
                this.vulnerabilities = response.data
                // this.items = response.data
            });
        },5000);
        axios.get(this.nist_vuln_api_url).then((response) => {
            console.log(response)
            this.nist_vulns = response.data
        })
        // axios.get(this.postgres_vuln_api_url).then((response) => {
        //     console.log(response)
        //     this.vulnerabilities = response.data
        //     console.log(this.vulnerabilities)
        // })
    },
    methods: {
        localIsVulnerable: function(item) {
            if (item.postgres_is_vulnerable == true || item.nist_keyword_warning == true) {
                return "table-danger"
            }
            return "table-primary"

        }
    },
}
</script>

<style lang="css" scoped>

</style>